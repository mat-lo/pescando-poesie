<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      body {
        background: #ccc;
      }
    </style>
  </head>
  <body>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.4.0/lib/p5.js"></script>
    <script>
      let cbook, cbold
      let waveImg, bait, footwave, arrow
      const poem = [
        "e d'aurei tristi vicini",
        "il Lago nostra a morte",
        "sopporta, un freddo",
        "i miei son caduti",
        "Sí come i notte bei",
        "4*6*17*30*27.69*36.7*8.25",
      ]

      const data = poem[poem.length - 1]
      const vals = data.split("*")
      const day = vals[0]
      const month = vals[1]
      const hours = vals[2]
      const minutes = vals[3]
      const temp = vals[4]
      const clorof = vals[5]
      const ph = vals[6]

      function preload() {
        cbook = loadFont("./Tickets/fonts/cbook.otf")
        cbold = loadFont("./Tickets/fonts/cbold.otf")
        waveImg = loadImage("./Tickets/images/wave.png")
        bait = loadImage("./Tickets/images/bait.png")
        footwave = loadImage("./Tickets/images/footwave.png")
        arrow = loadImage("./Tickets/images/arrow.png")
        logo = loadImage("./Tickets/images/logo.png")
      }
      function setup() {
        createCanvas(639, 1773)
        background(255)
        textAlign(LEFT, TOP)

        // header
        fill(0)
        textFont(cbold, 70)
        write("pescando", 250, 37, random(-2, 2))
        write("poesie", 190, 144, random(-3, 3))
        image(bait, 42, 0, 82, 285)
        wave(random(30, width - 130), 344)

        // poems
        const n = poem.length - 1
        const hspace = 750 / n
        if (n < 5) {
          wave(
            random(20, width - 150),
            450 + ~~random(n - 1) * hspace + hspace * 0.5
          )
        }

        textSize(35)
        for (let i = 0; i < n; i++) {
          const w = textWidth(poem[i])
          const x = random(20, width - w - 20)
          const y = 450 + i * hspace

          fill(0)

          //close left
          if (x > 200) {
            if (Math.random() > 0.5) {
              wave(random(50, 80), y)
            }
          }

          //close right
          if (width - w - x > 200) {
            if (Math.random() > 0.5) {
              wave(random(width - 190, width - 150), y)
            }
          }

          write(poem[i].toLowerCase(), x, y, random(-4, 4))
        }

        // footer
        image(footwave, 0, 1150, width, 11)
        fill(0)
        rect(0, 1160, width, height - 1160)
        image(arrow, 38, 1185, 23, 26)

        const h1 = [
          "Questi versi non sono scritti da un essere umano, bensì",
          "dal lago di Mantova. Con l’intelligenza artificiale",
          "abbiamo insegnato ai laghi a scrivere, trasformando",
          "dati ambientali in poesia.",
        ]

        const h2 = [
          `Questa fu scritta il giorno 7 Agosto alle ${hours}:${minutes}. La temperatura`,
          `era di ${temp}°, mentre la Clorofilla A era ${clorof} ug/l e il pH ${ph}.`,
          `Questi valori hanno ispirato il lago nella scrittura della poesia.`,
          `Com’è possibile? Leggilo qua → oio.studio/pesca`,
        ]

        const h3 = [
          "Pescando Poesie è un progetto di Matteo Loglio / oio per",
          "Edizioni Corraini, durante il Festivaletteratura 2021.",
          "I dati sono forniti dal CNR.",
        ]

        fill(255)
        textFont(cbook)
        textSize(21)
        footpara(h1, 80, 1205, random(-2, 2), false)
        footpara(h2, 28, 1375, -1, true)
        footpara(h3, 30, 1555, random(-2, 2), false)

        // logos
        image(logo, 10, 1730, 262, 27)
        textFont(cbold)
        textSize(40)
        write("ø", width - 110, 1725, random(-10, 10))
        write("i", width - 65, 1725, random(-10, 10))
        write("o", width - 35, 1725, random(-10, 10))
      }

      function draw() {}

      function write(what, x, y, r) {
        push()
        translate(x, y - 10)
        rotate(radians(r))
        text(what, 0, 0)
        pop()
      }

      function wave(x, y) {
        push()
        translate(x, y)
        rotate(radians(random(-7, 7)))
        image(waveImg, 0, 0, 102, 11)
        pop()
      }

      function footpara(array, x, y, r, linea) {
        push()
        translate(x, y)
        rotate(radians(r))
        array.forEach((string, i) => {
          text(string, 0, i * 30)
        })
        if (linea) {
          noFill()
          stroke(255)
          strokeWeight(2)
          line(310, 120, 467, 120)
          noStroke()
          fill(255)
        }
        pop()
      }
    </script>
  </body>
</html>
